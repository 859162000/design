<form name="editForm" method="post" ng-submit="save()" class="form-horizontal" novalidate="novalidate">
<div class="portlet light bordered" ng-if="!!current.entity">

<div class="portlet-title" app-print-hide>
	<div class="caption">
		<i class="fa fa-edit"></i>
		<span class="caption-subject sbold uppercase bold">
			<span app-locale="advance">预支申请</span>
			<small ng-bind="current.entity.id"></small>
		</span>
		<span class="caption-helper"></span>
	</div>
	<div class="actions" ng-include=" 'resources/template/application/edit/actions.html' "></div>
</div>
<div class="portlet-body form">
	<div class="form-body app-body">
	
	<div class="row"><!-- 头部信息,仅显示申请人等信息 -->
		<div class="col-md-12" ng-include=" 'resources/template/application/edit/header.html' "></div>
	</div>

<div class="row">
	<div class="col-md-4">
		<div class="form-group">
			<label class="control-label col-md-3" app-locale="advance.date">预支日期</label>
			<div class="col-md-9">
				<div class="input-group">
					<input type="date" class="form-control" ng-model="current.entity.propertyD00" required
						ng-min="app.today"
						uib-datepicker-popup is-open="openDatepicker">
					<div class="input-group-btn">
						<button class="btn btn-default" type="button" ng-click="openDatepicker=true">
							<span class="icon icon-calendar"></span><span class="sr-only">Split button!</span>
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-4">
		<div class="form-group">
			<label class="control-label col-md-3" app-locale="advance.return.date.expect">预计归还日期</label>
			<div class="col-md-9">
				<div class="input-group">
					<input type="date" class="form-control" ng-model="current.entity.propertyD01" 
						uib-datepicker-popup is-open="openExpectDatepicker" ng-min="current.entity.propertyD00">
					<div class="input-group-btn">
						<button class="btn btn-default" type="button" ng-click="openExpectDatepicker=true">
							<span class="icon icon-calendar"></span><span class="sr-only">Split button!</span>
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="row"><!-- 支付信息 -->
	<div class="col-md-12" ng-include=" 'resources/template/application/edit/payee.html' "></div>
</div>

<div class="row">
<div class="col-md-12">
	<h4 class="form-section">
		<span app-locale="advance.items">预支明细</span>
		<small><a href="javascript:;" ng-click="addItem()" title="{{ 'app.add' | appLocale }}"><i class="fa fa-plus"></i></a></small>
	</h4>
	<div class="table-responsive">
		<table class="table table-striped table-bordered table-condensed" role="grid">
			<thead>
				<tr>
					<th width="30" class="text-center row-number">#</th>
					<th app-locale="advance.item.type">预支类型</th>
					<th app-locale="budget.subject">预算科目</th>
					<th width="300" class="min-width-200" app-locale="application.item.remarks">详细事项描述</th>
					<th width="80" app-locale="application.amount">金额</th>
					<th class="text-center row-actions">
						<a href="javascript:;" ng-click="clearItems()" title="{{ 'app.remove.all' | appLocale }}"><i class="fa fa-remove"></i></a>
						<a href="javascript:;" ng-click="addItem()" title="{{ 'app.add' | appLocale }}"><i class="fa fa-plus"></i></a>
					</th>
				</tr>
			</thead>
			<tbody class="table-form">
				<tr ng-repeat="item in current.entity.items track by item.ordinal">
					<td class="row-number" ng-bind="$index+1"></td>
					<td app-dict-select="item.advanceType" dict-type="advanceType" class-name="input-sm" use-property="false" required change="changeAdvanceType(item)"></td>
					<td app-show="item.budgetSubject.id" url="/budgetSubject.do"></td>
					
					<td><input ng-model="item.remarks" class="form-control input-sm" ng-maxlength="300" required></td>
					<td><input model-type="number" class="form-control input-sm" min="0.01" required model-format="amount"
						ng-model="item.amount" ng-model-options="{ updateOn: 'blur' }" ng-change="changeAmount(item)"></td>
					<td class="text-center row-actions">
						<a href="javascript:;" ng-click="removeItem(item)" title="{{ 'app.remove' | appLocale }}"><i class="fa fa-remove"></i></a>
						<a href="javascript:;" ng-click="addItem(item)" title="{{ 'application.item.copy' | appLocale }}"><i class="fa fa-copy"></i></a>
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr class="info">
					<td colspan="4" app-locale="app.amount.total" class="text-right nowrap">合计金额</td>
					<td colspan="2" class="nowrap" ng-bind="current.entity.payee.amount | currency:current.entity.payee.currency.symbol"></td>
				</tr>
				<tr class="success" ng-if="app.currency.id != current.entity.payee.currency.id">
					<td colspan="4" app-locale="app.amount.total" class="text-right nowrap">人民币合计</td>
					<td colspan="2" class="nowrap" ng-bind="current.entity.amount | currency"></td>
				</tr>
			</tfoot>
		</table>
	</div>
</div>
</div>
	
	<div class="row"><!-- 附件，流程等信息 -->
		<div class="col-md-12">
			<div class="tabbable-custom" uib-tabset>
				<div uib-tab heading="{{ 'application.files' | appLocale }}">
					<div ng-include=" 'resources/template/application/edit/files.html' "></div>
				</div>
				<div uib-tab heading="{{ 'application.logs' | appLocale }}" 
					ng-if="current.entity.status == STATUS.REJECTION || current.entity.status == STATUS.REJECTION_PAY">
					<div ng-include=" 'resources/template/application/logs.html' "></div>
				</div>
			</div>
		</div>
	</div>

	<div class="row form-bar">
		<div class="col-md-12 text-center" app-print-action ng-include=" 'resources/template/application/edit/buttons.html' "></div>
	</div>

	</div>
</div>

</div>
</form>