<form name="editForm" method="post" ng-submit="save()" class="form-horizontal" novalidate="novalidate">
<div class="portlet light bordered">

<div class="portlet-title" app-print-hide>
	<div class="caption">
		<i class="fa fa-edit"></i>
		<span class="caption-subject sbold uppercase bold">
			<span app-locale="budget.adjust.list">预算调整</span>
			<small ng-bind="current.entity.id"></small>
		</span>
		<span class="caption-helper"></span>
	</div>
	<div class="actions" ng-include=" 'resources/template/application/edit/actions.html' "></div>
</div>
<div class="portlet-body form">
	<div class="form-body app-body">

	<div class="row">
		<div class="col-md-12" ng-include=" 'resources/template/application/edit/header.html' "></div>
	</div>

<div class="row">
	<div class="col-md-4">
		<div class="form-group">
			<label class="control-label col-md-3" app-locale="budget.adjust.type">调整类型</label>
			<div class="col-md-9">
				<div app-dict-select="current.entity.propertyC00" dict-type="budgetAdjustType" 
				inline="true" show-property="name" required="true" ></div>
			</div>
		</div>
	</div>
	<div class="col-md-4" ng-if="current.entity.propertyC00 == adjustType.callout || current.entity.propertyC00 == adjustType.callin ">
		<div class="form-group">
			<label ng-if="current.entity.propertyC00 == adjustType.callout" class="control-label col-md-3" app-locale="budget.adjust.in.conpamy">调入公司</label>
			<label ng-if="current.entity.propertyC00 == adjustType.callin" class="control-label col-md-3" app-locale="budget.adjust.out.conpamy">调出公司</label>
			<div class="col-md-9" app-select="current.entity.propertyN02" 
				change="clearItems()" url="dept.do" args="{ type: 'C' }" 
				required="true" >
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<h4 class="form-section">
			<span app-locale="budget.adjust.details">调整明细</span>
			<small><a href="javascript:;" ng-click="addItem()" title="{{ 'app.add' | appLocale }}"><i class="fa fa-plus"></i></a></small>
		</h4>
		<div class="table-responsive">
			<table class="table table-striped table-bordered table-condensed" role="grid" >
				<thead>
					<tr>
						<th class="row-number text-center">#</th>
						<th ng-if="current.entity.propertyC00 == adjustType.callin" app-locale="budget.adjust.out.dept">调出部门</th>
						<th ng-if="current.entity.propertyC00 != adjustType.additional" width="200" app-locale="budget.adjust.out.subject">调出科目</th>
						<th ng-if="current.entity.propertyC00 == adjustType.callout" app-locale="budget.adjust.int.dept">调入部门</th>
						<th ng-if="current.entity.propertyC00 != adjustType.additional" width="200" app-locale="budget.adjust.in.subject">调入科目</th>
						<th ng-if="current.entity.propertyC00 == adjustType.additional" width="200" app-locale="budget.adjust.add.subject">追加科目</th>
						<th app-locale="budget.adjust.amount">调整金额</th>
						<th app-locale="budget.adjust.message">调整原因</th>
						<th class="row-actions text-center">
							<a href="javascript:;" ng-click="clearItems()" title="{{ 'app.remove.all' | appLocale }}"><i class="fa fa-remove"></i></a>
							<a href="javascript:;" ng-click="addItem()" title="{{ 'app.add' | appLocale }}"><i class="fa fa-plus"></i></a>
						</th>
					</tr>
				</thead>
				<tbody class="table-form">
					<tr ng-repeat="item in current.entity.items track by item.ordinal">
						<td class="row-number" ng-bind="$index+1"></td>
						<td ng-if="current.entity.propertyC00 == adjustType.callin" app-select="item.budgetDept" url="dept.do" use-property="false" required="true" 
								args="{ type: 'D', companyId: current.entity.propertyN02 }" >
						</td>
						<td app-ui-select="item.budgetSubject" url="budgetSubject.do" use-property="false" required="true" 
								args="{ type: 'budget', control: '1', adjust: '1' }" ></td>
						<td ng-if="current.entity.propertyC00 == adjustType.callout" app-select="item.costDept" url="dept.do" use-property="false" required="true" 
								args="{ type: 'D', companyId: current.entity.propertyN02 }" >
						</td>
						<td ng-if="current.entity.propertyC00 != adjustType.additional" app-ui-select="item.propertyN00" 
								url="budgetSubject.do" required="true" args="{ type: 'budget', control: '1', adjust: '1' }" ></td>
						<td><input model-type="number" class="form-control input-sm" ng-model="item.amountCost" 
								min="0.01" model-format="amount" required ng-change="changeAmountCost(item)"></td>
						<td><input class="form-control" ng-model="item.remarks" ng-maxlength="300" ></td>
						
						<td class="row-actions text-center">
							<a href="javascript:;" ng-click="removeItem(item)" title="{{ 'app.remove' | appLocale }}"><i class="fa fa-remove"></i></a>
							<a href="javascript:;" ng-click="addItem(item)" title="{{ 'application.item.copy' | appLocale }}"><i class="fa fa-copy"></i></a>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<tr class="success" ng-if="current.entity.propertyC00 == adjustType.additional ">
						<td colspan="2" app-locale="app.amount.total" class="text-right">合计金额</td>
						<td colspan="3" ng-bind="current.entity.amountCost | currency"></td>
					</tr>
					<tr class="success" ng-if="current.entity.propertyC00 == adjustType.inside ">
						<td colspan="3" app-locale="app.amount.total" class="text-right">合计金额</td>
						<td colspan="3" ng-bind="current.entity.amountCost | currency"></td>
					</tr>
					<tr class="success" ng-if="current.entity.propertyC00 == adjustType.callout || current.entity.propertyC00 == adjustType.callin ">
						<td colspan="4" app-locale="app.amount.total" class="text-right">合计金额</td>
						<td colspan="3" ng-bind="current.entity.amountCost | currency"></td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
</div>

	<div class="row"><!-- 附件，流程等信息 -->
		<div class="col-md-12">
			<div class="tabbable-custom" uib-tabset>
				<div uib-tab heading="{{ 'application.files' | appLocale }}">
					<div ng-include=" 'resources/template/application/edit/files.html' "></div>
				</div>
				<div uib-tab heading="{{ 'application.logs' | appLocale }}" ng-if="current.entity.status == STATUS.REJECTION || current.entity.status == STATUS.REJECTION_PAY">
					<div ng-include=" 'resources/template/application/logs.html' "></div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12 text-center" app-print-hide ng-include=" 'resources/template/application/edit/buttons.html' "></div>
	</div>

	</div>
</div>

</div>
</form>