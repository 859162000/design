orcle相关命令收集

1， 用管理员登陆：/as sysdba
	连接用户
	conn name/password；

2， 更改用户密码
	alter user name identified by password；
	alter user exptest identified by exptest;
	查询用户：select username,password from dba_users;
	
3， 创建用户名
	create user coco identified by coco;
	create user exptest identified by D33gw1TYs;
	
	3.1授权
	create user coco identified by coco;
	alter user coco default tablespace oa_data;
	alter user coco quota unlimited on oa_data;
	grant create session to coco;  
	grant create table to coco;  
	grant create tablespace to coco;  
	grant create view to coco; 
	grant alter tablespace to coco;
	grant dba to coco;
	grant select ,insert(sno,cno),update on sscc to coco--为用户对象付特权

4， 表空间创建	
	4.1 创建用户给默认表空间：
		create user username identified by password   default tablespace user_data;
		创建表空间：
		create tablespace OA_DATA datafile 'D:\data\oracle\oa_data.dbf' size 50m autoextend on 
					next 50m maxsize 512m extent management local;
					
	4.2 为用户指定表空间
		alter user coco default tablespace OA_DATA;
		
	4.3 解除锁定
		alter user ems account unlock

	4.4 ORA-1658 无法为表空间的段创建initial区
		
5， 查询所有空间
	5.1 select tablespace_name from dba_tablespaces;
	
	5.2 修改用户默认表空间 alter user coco default tablespace oatest;

6， 查询数据库版本
	select * from v$version;
	
7， 查询用户自己所在的表空间
	select username,default_tablespace from user_users;

	7.1查询用户权限
	select * from dba_sys_privs;
	select * from user_sys_privs;
 
	7.2查看角色(只能查看登陆用户拥有的角色)所包含的权限
	select * from role_sys_privs;

	7.3查看用户对象权限：
  	select * from dba_tab_privs;
  	select * from all_tab_privs;
  	select * from user_tab_privs;

	7.4查看所有角色：
	select * from dba_roles;
	
8， 查询数据库的sid
	show parameter instance_name;
	
9， 查看sid
	select instance_name from v$instance;
	
10，判断连接
	telnet 127.0.0.1 1521
	ping 10.132.21.18
	
11，登陆远程sql plus
	conn exptest/cc@10.132.21.18/oatest;
	//10.132.21.18:1521:oatest
	
12，创建数据库之间的连接dblink
	create database link linkexp
	connect to exptest identified by D33gw1TYs
	using '(DESCRIPTION =
	(ADDRESS_LIST =
	(ADDRESS = (PROTOCOL = TCP)(HOST = 10.132.21.18)(PORT = 1521))
	)
	(CONNECT_DATA =
	(SERVICE_NAME = oatest)
	)
	)';

13，删除dblink
	Drop public DATABASE LINK linkme;
	Drop DATABASE LINK linkme;
	
14，tnsnames.ora配置
	D:\app\Administrator\product\11.2.0\client_1\network\admin\tnsnames.ora,
	# tnsnames.ora Network Configuration File: D:\app\Administrator\product\11.2.0\dbhome_2\NETWORK\ADMIN\tnsnames.ora
	# Generated by Oracle configuration tools.

	LISTENER_ORCL =
	  (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))


	ORCL =
	  (DESCRIPTION =
		(ADDRESS_LIST =
		  (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
		)
		(CONNECT_DATA =
		  (SID = orcl)
		  (SERVER = DEDICATED)
		  (SERVICE_NAME = orcl)
		)
	  )

	14.1――ORA-01034和ORA-27101
	出现ORA-01034和ORA-27101的原因是多方面的：主要是oracle当前的服务不可用，shared memory realm does not exist，是因为oracle没有启动或没有正常启动，共享内存并没有分配给当前实例.所以，通过设置实例名，再用操作系统身份验证的方式，启动数据库。这样数据库就正常启动了，就不会报ORA-01034和ORA-27101两个启动异常了。还有就是可能是登录数据库后，不正常的退出，比如直接关掉窗口，而这时数据库里有未完成的动作。
  
15，oracle卸载
	运行regedit，删除HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE
	HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services，滚动 这个列表，删除所有Oracle入口。 
	HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application， 删除所有Oracle入口。

16，管理员权限
	grant dba to coco; 
	--Revoke dba from coco;
	
17，迁移数据库
	当本地用户名与服务器端不一致时，需要在本地建立一个相同的用户
	17.1导入数据库
		@d:/EE.sql
		PL/SQL中直接写@
	 
18，查看用户空间下所有的表
	-- connect xx/xx 切换到这个用户
	select * from tab;

19，共享命令，安装12c时用到：net share nu=c:\ /grant:everyone,full

20，导出命令exp coco/coco@orcl file=d:\exp.dmp full=y;
	    exp exptest/exptest@localhost:1521/orcl file=d:\exp.dmp full=y;
	    exp ems/D33gw1TYs@10.132.21.18/oatest file=d:\exp.dmp;
  	    exp oapre/Cq#1988@10.132.21.18/oapre file=d:\oapre.dmp;
		exp iot_app/iot_app@192.168.202.253/iot file=d:\data\oracle\iot_app.dmp;
		
		url="jdbc:oracle:thin:@10.132.21.18:1521:oapre"
		username="oapre"
		password="Cq#1988"

	    exp iot_appaa/iot_app@192.168.156.23/bjdb file=d:\data\iot\bjdb.dmp;
		[ORA-00904]根据网上的资料和总结，分析可能是本地使用的exp导出工具的版本与数据库服务器端exp版本不一致导致

		导入命令：
	    imp coco/coco file=uat.dmp fromuser=oapre touser=coco tablespaces=users;
	    imp ems/ems file=ems.dmp fromuser=ems touser=ems tablespaces=oa_data;


	20.1，导出指定表：exp 用户名/密码@数据库名 file=c:\filename.dmp tables=(table1,table2).
		必须在括号中列出所有表名
		
	20.2，导出特定用户所有表：exp 用户名/密码@数据库名 file=c:\filename.dmp  owner=用户名

21，查询相关：查询有clob字段的表
	select distinct('TABLE "'||a.OWNER ||'"."'||a.TABLE_NAME||'"') from sys.all_tab_columns a 
	where  a.OWNER = 'EXPTEST' and a.TABLE_NAME not in (
		   select t.TABLE_NAME from sys.all_tab_columns t 
		   where t.OWNER = 'EXPTEST' and t.DATA_TYPE in ('CLOB','BLOB')
	);
	21.1,oracle查询字符长度：length()
	21.2,sqlserver查询字符长度：len():
		select * from t_department where len(departMentCostCode) > 0;
		
	21.3,查询重复	select msisdn,count(1) from cm_subs_statuschg group by msisdn having count(1)>1
		a单字段：	select upper(code),count(1) from t_user group by upper(code) having count(1)>1
		b全字段：	select * from login where Id in (select Id from login group by Id having count(Id) > 1)
		c数字中的空值
					select * from table t where t.field is null;
		
	21.4,去重复组合
		查询：
		select * from t_user where upper(code) in (select upper(code) 
			from t_user group by upper(code) having count(upper(code)) > 1)
		删除：
		DELETE from t_user WHERE (upper(code)) IN ( 
		   SELECT upper(code) FROM t_user GROUP BY upper(code) HAVING COUNT(upper(code)) > 1
		) AND ROWID NOT IN (SELECT MIN(ROWID) FROM t_user 
		GROUP BY upper(code) HAVING COUNT(*) > 1);
			
	21.5,去密码为空
		update t_user t set t.logon_password = '4a7d1ed414474e4033ac29ccb8653d9b' where  t.logon_password is null;
		
	21.6,分页查询
		select * from (
			select rownum as rowno, t.* from FIN_ACCOUNTING_SUBJECT t where rownum <= 2
		) account where account.rowno >= 1
		
	21.7,exist与in
		select a.moni_id, a.desAddr, a.subject, a.content, a.create_time from moni_result_mail a where exists(select b.create_time from moni_result_mail_his b where a.create_time = b.create_time)
		in引导的子句只能返回一个字段
		exists强调的是是否返回结果集，不要求知道返回什么
		EXISTS与IN,意思相同不过语法上有点点区别，IN效率差，应该是不会执行索引的原因


	21.8,select mail_list, count(mail_list) from moni_mail_list group by mail_list
		查询某个字段中的值重复次数

	21.9,查询大于某个日期
		SELECT * FROM cm_subs_statuschg t WHERE t.createdate > to_date('2016/9/7 00:00:00', 'YYYY/MM/DD HH24:MI:SS');
		
22，误操作
	22.1删除之前闪回
		flashback table AA to before drop;
	22.2指定时间之前闪回
		alter table AA enable row movement;
		flashback table AA to timestamp to_timestamp('2016-02-18 10:25:21','yyyy-mm-dd hh24:mi:ss');
	22.3通过查询闪回 
	        select * from AA as of timestamp TO_TIMESTAMP('2016-02-19 13:36:05', 'yyyy-mm-dd hh24:mi:ss'); 
		

23，插入时间类型
	select to_date('2005-01-01 13:14:20','yyyy-MM-dd HH24:mi:ss') from dual; 
	MM和mm被认为是相同的格式代码，所以Oracle的SQL采用了mi代替分钟

24，通过select插入数据
	insert into table1(id, dept_id, user_id, role_id) select 1,2,3,table2.name from table2 ;
	insert into t_user_role(id, dept_id, user_id, role_id, company_id) select (1000+t_user.id), t_user.dept_id, t_user.id,'user',t_user.company_id from t_user where t_user.id > 10;

25，物化视图：
	释义：内存快照，普通视图是一组查询语句集合，调用时本质是一种select过程。物化视图则是一组内存快照，将一段时间的视图数据读取出来放在一个单独的物理空间。
	
26，SGA：oracle系统全局内存区域。
	26.1：共享池是oracle缓存数据的地方

27，表分区关键字
	partition by range (PROVINCEID)
	(
	  partition PART100 values less than ('101')
		tablespace IOTDATA01
		pctfree 10
		initrans 1
		maxtrans 255
		storage
		(
		  initial 64K
		  next 1M
		  minextents 1
		  maxextents unlimited
		),
		...
	)
	27.1分区时机 Tables greater than 2GB should always be considered for partitioning
	27.2分区类型
		a范围分区（range）
		b哈希分区（hash）
		c列表分区（list）
		d范围－哈希复合分区（range-hash）
		e范围－列表复合分区（range-list）

	27.3按时机分区
		create table pdba (id number, time date) partition by range (time)
		(
			partition p1 values less than (to_date('2010-10-1', 'yyyy-mm-dd')),
			partition p2 values less than (to_date('2010-11-1', 'yyyy-mm-dd')),
			partition p3 values less than (to_date('2010-12-1', 'yyyy-mm-dd')),
			partition p4 values less than (maxvalue)
		)

28，索引相关
	28.1 create index index_me_id on me(id);
	28.2 oracle 在创建主键时，会为库表自动创建索引
